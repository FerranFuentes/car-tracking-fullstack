# Imagen base
FROM node:14.18.1

# Establecer el directorio de trabajo
WORKDIR /app

# Instalar Ganache y Truffle
RUN npm install -g ganache-cli 

#Instalar Truffle
RUN npm install -g truffle@5.4.23

# Copiar los archivos necesarios
COPY package*.json ./
COPY truffle-config.js ./
COPY contracts ./contracts
COPY migrations ./migrations
COPY src ./src
COPY bs-config.json ./

# Instalar las dependencias
RUN npm install

# Copiar el script de inicio
COPY start.sh ./
RUN chmod +x start.sh

# Exponer el puerto necesario para la aplicaciÃ³n
EXPOSE 3000 7545 8545

RUN echo "truffle migrate --network development --reset --compile-all" > /usr/local/bin/start.sh && chmod +x /usr/local/bin/start.sh

# Comando a ejecutar al arrancar el contenedor
CMD ["./start.sh"]